(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{zWIZ:function(e,t,s){"use strict";s.r(t),s.d(t,"ChatPageModule",function(){return le});var i=s("SVse"),n=s("s7LF"),o=s("sZkV"),c=s("iInd"),a=s("mrSG"),r=s("SAju"),l=s("5Lyb"),p=s("8Y7J");function g(e,t){1&e&&(p.Rb(0,"p",3),p.Ac(1," Action Execution in Progress\n"),p.Qb())}function h(e,t){1&e&&(p.Rb(0,"p",4),p.Ac(1," Action Execution Success\n"),p.Qb())}function b(e,t){1&e&&(p.Rb(0,"p",5),p.Ac(1," Action Execution Failure\n"),p.Qb())}let u=(()=>{class e{constructor(e,t){this.chatActionService=e,this.route=t,this.executionStatus="in_progress",this.getActionFromParams().then(e=>{this.actionType=e.type,this.actionJSON=JSON.stringify(e),this.chatActionService.executeChatAction(e).then(()=>{this.executionStatus="success"},e=>{this.executionStatus="failure",this.debugMsg="Failed: "+e})},e=>{this.debugMsg="Failed to create action: "+e})}getActionFromParams(){return Object(a.a)(this,void 0,void 0,function*(){const e=this.route.snapshot.paramMap.get("actionType");if(e&&r.a[e])return{type:e,executed:!1,params:this.route.snapshot.queryParams};throw"No chat action with type "+e})}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(p.Mb(l.a),p.Mb(c.a))},e.\u0275cmp=p.Gb({type:e,selectors:[["plh-chat-action"]],decls:9,vars:6,consts:[["style","color: yellow",4,"ngIf"],["style","color: green",4,"ngIf"],["style","color: red",4,"ngIf"],[2,"color","yellow"],[2,"color","green"],[2,"color","red"]],template:function(e,t){1&e&&(p.Rb(0,"p"),p.Ac(1),p.Qb(),p.Rb(2,"p"),p.Ac(3),p.Qb(),p.yc(4,g,2,0,"p",0),p.yc(5,h,2,0,"p",1),p.yc(6,b,2,0,"p",2),p.Rb(7,"p"),p.Ac(8),p.Qb()),2&e&&(p.Ab(1),p.Cc(" Chat Action: ",t.actionType,"\n"),p.Ab(2),p.Cc(" Action JSON: ",t.actionJSON,"\n"),p.Ab(1),p.ic("ngIf","in_progress"==t.executionStatus),p.Ab(1),p.ic("ngIf","success"==t.executionStatus),p.Ab(1),p.ic("ngIf","failure"==t.executionStatus),p.Ab(2),p.Cc(" ",t.debugMsg,"\n"))},directives:[i.l],styles:[""]}),e})();var d=s("gcOT"),m=s("Qpa5"),f=s("7zx7"),v=s("i+cc"),y=s("YVjz"),w=s("GJmQ"),x=s("IHle");let O=(()=>{class e{constructor(e){this.notificationService=e,this.type="online",this.messages$=new f.a([]),this.ready$=new f.a(!1),this.init()}ready(){return Object(a.a)(this,void 0,void 0,function*(){return this.ready$.pipe(Object(w.a)(e=>!1===e)).toPromise()})}init(){return Object(a.a)(this,void 0,void 0,function*(){d.a.isNative&&(yield this.notificationService.init(),this.ready$.next(!0))})}startFlowByName(e){return Object(a.a)(this,void 0,void 0,function*(){return this.messages$.complete(),this.messages$=new f.a([]),this.subscription&&this.subscription.unsubscribe(),this.subscription=this.notificationService.messages$.subscribe(e=>{Object(x.a)(e).then(e=>{this.messages$.next(this.messages$.getValue().concat([e]))})},e=>{this.messages$.error(e)}),yield this.notificationService.sendRapidproMessage(e),this.messages$})}sendMessage(e){return Object(v.a)(this.notificationService.sendRapidproMessage(e.text))}}return e.\u0275fac=function(t){return new(t||e)(p.Vb(y.a))},e.\u0275prov=p.Ib({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var S=s("Tesu"),M=s("Jr/a"),k=s("NiZn");function A(e,t){if(1&e&&p.Nb(0,"img",5),2&e){const e=p.cc().$implicit;p.ic("src",e.imageUrl,p.sc)}}const C=function(e){return{large:e}};function R(e,t){if(1&e){const e=p.Sb();p.Rb(0,"div",3),p.Zb("click",function(){p.qc(e);const s=t.$implicit;return p.cc().selectResponseOption(s)}),p.yc(1,A,1,1,"img",4),p.Rb(2,"span"),p.Ac(3),p.Qb(),p.Qb()}if(2&e){const e=t.$implicit;p.ic("ngClass",p.lc(3,C,e.text.length<2)),p.Ab(1),p.ic("ngIf",e.imageUrl),p.Ab(2),p.Bc(e.text)}}let I=(()=>{class e{constructor(e){this.modalController=e,this.onOptionSelect=new p.o}ngOnInit(){}selectResponseOption(e){this.onOptionSelect.emit(e),this.modalController.dismiss()}}return e.\u0275fac=function(t){return new(t||e)(p.Mb(o.G))},e.\u0275cmp=p.Gb({type:e,selectors:[["plh-responses-modal"]],inputs:{responseOptions:"responseOptions"},outputs:{onOptionSelect:"onOptionSelect"},decls:3,vars:1,consts:[[1,"chat-responses-modal"],[1,"response-options"],["class","response-option",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"response-option",3,"ngClass","click"],[3,"src",4,"ngIf"],[3,"src"]],template:function(e,t){1&e&&(p.Rb(0,"div",0),p.Rb(1,"div",1),p.yc(2,R,4,5,"div",2),p.Qb(),p.Qb()),2&e&&(p.Ab(2),p.ic("ngForOf",t.responseOptions))},directives:[i.k,i.j,i.l],styles:[".response-options[_ngcontent-%COMP%]{align-self:flex-end;width:100%;display:flex;flex-wrap:wrap;padding:16px}.response-option[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;color:var(--ion-primary-color,#0d4060);background-color:#fff;padding:7px;font-size:14px;margin:10px;border-radius:20px;border:3px solid var(--ion-primary-color,#0d4060);white-space:nowrap}.response-option[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-align:center}.response-option.large[_ngcontent-%COMP%]{font-size:40px;border-radius:40px}.response-option[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:150px}"]}),e})();function N(e,t){1&e&&p.Nb(0,"ion-icon",6)}const _=function(e){return{ticked:e}};function Q(e,t){if(1&e){const e=p.Sb();p.Rb(0,"div",4),p.Zb("click",function(){p.qc(e);const t=p.cc(2);return t.ticked=!t.ticked}),p.yc(1,N,1,0,"ion-icon",5),p.Qb()}if(2&e){const e=p.cc(2);p.ic("ngClass",p.lc(2,_,e.ticked)),p.Ab(1),p.ic("ngIf",e.ticked)}}function F(e,t){if(1&e&&p.Nb(0,"img",10),2&e){const e=p.cc().$implicit;p.ic("src",e.imageUrl,p.sc)}}function P(e,t){if(1&e&&(p.Rb(0,"span"),p.Ac(1),p.Qb()),2&e){const e=p.cc().$implicit;p.Ab(1),p.Bc(e.text)}}function T(e,t){if(1&e){const e=p.Sb();p.Rb(0,"div",7),p.Zb("click",function(){p.qc(e);const s=t.$implicit;return p.cc(2).selectResponseOption(s)}),p.yc(1,F,1,1,"img",8),p.yc(2,P,2,1,"span",9),p.Qb()}if(2&e){const e=t.$implicit;p.Ab(1),p.ic("ngIf",e.imageUrl),p.Ab(1),p.ic("ngIf",!e.hideText)}}function j(e,t){if(1&e&&(p.Rb(0,"div",1),p.yc(1,Q,2,4,"div",2),p.yc(2,T,3,2,"div",3),p.Qb()),2&e){const e=p.cc();p.Ab(1),p.ic("ngIf",e.message.displayAsTick),p.Ab(1),p.ic("ngForOf",e.getResponseOptions())}}let E=(()=>{class e{constructor(e,t){this.modalController=e,this.settingsService=t,this.ticked=!0,this.onOptionSelect=new p.o,this.useModal=!1,this.settingsService.getUserSetting("USE_MODAL_FOR_CHAT_RESPONSES").subscribe(e=>{this.useModal="true"===e})}ngOnChanges(e){this.useModal&&e.responseOptions&&e.responseOptions.currentValue&&e.responseOptions.currentValue.length>0&&this.modalController.create({component:I,componentProps:{responseOptions:this.responseOptions,message:this.message,onOptionSelect:this.onOptionSelect},cssClass:"slide-up-modal",backdropDismiss:!1,swipeToClose:!1}).then(e=>e.present()),e.message.currentValue!==e.message.previousValue&&(this.ticked=!!this.message.tickedByDefault)}selectResponseOption(e){this.onOptionSelect.emit(e)}getResponseOptions(){return this.message&&this.message.displayAsTick&&this.message.responseOptions.length>=2?this.ticked?[this.message.responseOptions[0]]:[this.message.responseOptions[1]]:this.message.responseOptions}}return e.\u0275fac=function(t){return new(t||e)(p.Mb(o.G),p.Mb(S.a))},e.\u0275cmp=p.Gb({type:e,selectors:[["plh-chat-responses"]],inputs:{responseOptions:"responseOptions",message:"message"},outputs:{onOptionSelect:"onOptionSelect"},features:[p.yb],decls:1,vars:1,consts:[["class","response-options",4,"ngIf"],[1,"response-options"],["class","checkbox",3,"ngClass","click",4,"ngIf"],["class","response-option",3,"click",4,"ngFor","ngForOf"],[1,"checkbox",3,"ngClass","click"],["name","checkmark-outline",4,"ngIf"],["name","checkmark-outline"],[1,"response-option",3,"click"],[3,"src",4,"ngIf"],[4,"ngIf"],[3,"src"]],template:function(e,t){1&e&&p.yc(0,j,3,2,"div",0),2&e&&p.ic("ngIf",!t.useModal)},directives:[i.l,i.k,i.j,o.l],styles:["[_nghost-%COMP%]{background:hsla(0,0%,100%,.7)}.response-options[_ngcontent-%COMP%]{max-height:50vh;align-self:flex-end;width:100%;display:flex;flex-wrap:wrap;padding:16px;overflow:auto}.response-option[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;color:var(--ion-primary-color,#0d4060);background-color:#fff;padding:7px;font-size:14px;margin:10px;border-radius:20px;border:3px solid var(--ion-primary-color,#0d4060);min-width:25vw}.response-option[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-align:center}.response-option.large[_ngcontent-%COMP%]{font-size:40px;border-radius:40px}.response-option[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:150px}.checkbox[_ngcontent-%COMP%]{margin:10px;width:40px;height:40px;border-radius:10px;border:3px solid var(--ion-primary-color,#0d4060)}.checkbox.ticked[_ngcontent-%COMP%]{background-color:var(--ion-primary-color,#0d4060);color:#fff}.checkbox[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{width:100%;height:100%}"]}),e})();const $=["normalChatEnd"];function B(e,t){if(1&e){const e=p.Sb();p.Rb(0,"div",14),p.Rb(1,"ion-button",15),p.Zb("click",function(){return p.qc(e),p.cc(2).modalCtrl.dismiss()}),p.Nb(2,"ion-icon",16),p.Qb(),p.Qb()}}function V(e,t){if(1&e&&(p.Rb(0,"div",17),p.Rb(1,"p"),p.Ac(2),p.Qb(),p.Rb(3,"p"),p.Ac(4),p.Qb(),p.Rb(5,"p"),p.Ac(6),p.Qb(),p.Rb(7,"p"),p.Ac(8),p.Qb(),p.Qb()),2&e){const e=p.cc(2);p.Ab(2),p.Cc("Messages Sent ",e.messagesSent,""),p.Ab(2),p.Cc("Messages Received ",e.messagesReceived,""),p.Ab(2),p.Bc(e.debugMsg),p.Ab(2),p.Bc(e.stringify(e.messages[e.messages.length-1]))}}function L(e,t){if(1&e&&(p.Rb(0,"div"),p.Rb(1,"p"),p.Ac(2),p.Qb(),p.Qb()),2&e){const e=p.cc(2);p.Ab(2),p.Dc("Flow Name: ",null==e.latestFlowEvent?null:e.latestFlowEvent.name," : ",null==e.latestFlowEvent?null:e.latestFlowEvent.status,"")}}function z(e,t){if(1&e&&(p.Rb(0,"div"),p.Nb(1,"img",25),p.Qb()),2&e){const e=p.cc().$implicit;p.Ab(1),p.ic("src","assets/plh_assets/plh_images/characters/"+e.character.toLowerCase().trim()+"/neutral.svg",p.sc)}}function D(e,t){1&e&&(p.bc(),p.Rb(0,"svg",26),p.Nb(1,"path",27),p.Qb())}function U(e,t){if(1&e&&p.Nb(0,"div",28),2&e){const e=p.cc().$implicit;p.ic("innerHTML",e.text,p.rc)}}function J(e,t){if(1&e&&p.Nb(0,"img",29),2&e){const e=p.cc().$implicit;p.ic("src",e.innerImageUrl,p.sc)}}function Z(e,t){1&e&&(p.bc(),p.Rb(0,"svg",30),p.Nb(1,"path",31),p.Qb())}function G(e,t){if(1&e&&p.Nb(0,"img",29),2&e){const e=p.cc().$implicit;p.ic("src",e.url,p.sc)}}function q(e,t){1&e&&(p.Rb(0,"div",32),p.yc(1,G,1,1,"img",33),p.Qb()),2&e&&(p.ic("ngSwitch",t.$implicit.type),p.Ab(1),p.ic("ngSwitchCase","image"))}const H=function(e,t){return{bot:e,user:t}};function W(e,t){if(1&e&&(p.Rb(0,"div"),p.yc(1,z,2,1,"div",8),p.Rb(2,"div",18),p.yc(3,D,2,0,"svg",19),p.Rb(4,"div",20),p.yc(5,U,1,1,"div",21),p.yc(6,J,1,1,"img",22),p.Qb(),p.yc(7,Z,2,0,"svg",23),p.Qb(),p.yc(8,q,2,2,"div",24),p.Qb()),2&e){const e=t.$implicit,s=t.index,i=p.cc(2);p.Cb("bot"===e.sender?"msg-container bot-msg":"msg-container user-msg"),p.Ab(1),p.ic("ngIf",e.character&&!i.sameAsLastCharacter(e,i.messages[s-1])),p.Ab(1),p.ic("ngClass",p.mc(9,H,"bot"===e.sender,"user"===e.sender)),p.Ab(1),p.ic("ngIf","bot"===e.sender),p.Ab(2),p.ic("ngIf",!e.hideText),p.Ab(1),p.ic("ngIf",e.innerImageUrl),p.Ab(1),p.ic("ngIf","user"===e.sender),p.Ab(1),p.ic("ngForOf",e.attachments)}}function K(e,t){if(1&e&&p.Nb(0,"ng-lottie",34),2&e){const e=p.cc(2);p.ic("options",e.typingAnimOptions)}}function Y(e,t){if(1&e){const e=p.Sb();p.Rb(0,"plh-chat-responses",35),p.Zb("onOptionSelect",function(t){return p.qc(e),p.cc(2).selectResponseOption(t)}),p.Qb()}if(2&e){const e=p.cc(2);p.ic("responseOptions",null==e.lastReceivedMsg?null:e.lastReceivedMsg.responseOptions)("message",e.lastReceivedMsg)}}function X(e,t){if(1&e&&(p.Rb(0,"div",2),p.yc(1,B,3,0,"div",3),p.Rb(2,"div",4,5),p.Rb(4,"div",6),p.yc(5,V,9,4,"div",7),p.yc(6,L,3,2,"div",8),p.yc(7,W,9,12,"div",9),p.yc(8,K,1,1,"ng-lottie",10),p.Qb(),p.Nb(9,"div",null,11),p.Nb(11,"div",12),p.Qb(),p.yc(12,Y,1,2,"plh-chat-responses",13),p.Qb()),2&e){const e=p.cc();p.Ab(1),p.ic("ngIf",e.isModal),p.Ab(4),p.ic("ngIf",e.autoReplyEnabled),p.Ab(1),p.ic("ngIf",e.showFlowName&&e.latestFlowEvent),p.Ab(1),p.ic("ngForOf",e.messages),p.Ab(1),p.ic("ngIf",e.botTyping),p.Ab(4),p.ic("ngIf",e.lastReceivedMsg)}}function ee(e,t){if(1&e){const e=p.Sb();p.Rb(0,"div",42),p.Zb("click",function(){return p.qc(e),p.cc(3).onStoryPreviousClicked()}),p.Ac(1," Previous "),p.Qb()}}function te(e,t){if(1&e){const e=p.Sb();p.Rb(0,"div",42),p.Zb("click",function(){return p.qc(e),p.cc(3).onStoryNextClicked()}),p.Ac(1," Next "),p.Qb()}}function se(e,t){if(1&e&&(p.Rb(0,"div",40),p.yc(1,ee,2,0,"div",41),p.yc(2,te,2,0,"div",41),p.Qb()),2&e){const e=t.$implicit;p.Ab(1),p.ic("ngIf","previous"===e.text.toLowerCase()),p.Ab(1),p.ic("ngIf","previous"!==e.text.toLowerCase())}}function ie(e,t){if(1&e&&(p.Rb(0,"div",36),p.Nb(1,"div",37),p.Rb(2,"div",38),p.yc(3,se,3,2,"div",39),p.Qb(),p.Qb()),2&e){const e=p.cc();p.Ab(1),p.ic("innerHTML",e.lastReceivedMsg.text,p.rc),p.Ab(2),p.ic("ngForOf",e.responseOptions)}}let ne=(()=>{class e{constructor(e,t,s,i,n,o,c,a,r,l){this.cd=e,this.route=t,this.router=s,this.chatActionService=i,this.settingsService=n,this.offlineChatService=o,this.onlineChatService=c,this.modalCtrl=a,this.alertController=r,this.contactFieldService=l,this.messages=[],this.allMessages=[],this.showFlowSkip=!0,this.responseOptions=[],this.botBlobState="walking-in",this.backgroundBlobVisible=!1,this.botAnimOptions={loop:!1,path:"/assets/lottie-animations/Walk_In_Entrance_Pass_v2.json"},this.autoReplyEnabled=!1,this.autoReplyDelay=500,this.autoReplyWord="N",this.autoRepeatPhrase="Repeat simulation",this.autoEndPhrase="THE END",this.messagesSent=0,this.messagesReceived=0,this.debugMsg="testing???",this.sentResponsesByMessage={},this.inputValue="",this.showingAllMessages=!0,this.character="guide",this.chatViewType="normal",this.showFlowName=!1,this.botTyping=!1,this.typingAnimOptions={path:"assets/lottie-animations/3759-typing.json",loop:!0,autoplay:!0}}ionViewDidEnter(){this.checkIsModal(),this.processRouteParams(),this.processRouteQueryParams(),this.initChatService().then(()=>{this.startFlow(this.flowName)})}initChatService(){return Object(a.a)(this,void 0,void 0,function*(){this.chatService=this.offlineChatService,this.offlineChatService.botTyping$.subscribe(e=>{this.botTyping=e}),"offline"===this.chatService.type&&(this.offlineChatService.flowStatus$.subscribe(e=>{e.length>0&&(this.latestFlowEvent=e[e.length-1])}),this.settingsService.getUserSetting("SHOW_FLOW_NAME").subscribe(e=>{this.showFlowName="true"===e})),console.log(`%cUsing ${this.chatService.type} chat `,"color: #9c9c9c")})}showCustomInputAlert(){return Object(a.a)(this,void 0,void 0,function*(){const e=yield this.alertController.create({header:this.lastReceivedMsg.text,inputs:[{type:"text"}],buttons:[{text:"Submit",handler:e=>{this.sendCustomOption(e[0])}}]});yield e.present()})}checkIsModal(){this.modalCtrl.getTop().then(e=>this.isModal=!!e)}processRouteParams(){const{params:e}=this.route.snapshot;e.flowName&&(this.flowName=e.flowName)}processRouteQueryParams(){const{queryParams:e}=this.route.snapshot;this.character=e.character||"guide"}startFlow(e){return Object(a.a)(this,void 0,void 0,function*(){yield this.chatService.ready(),e?(this.chatService.startFlowByName(e),this.messageSubscription=this.chatService.messages$.subscribe(e=>{if(e.length>0){const t=e[e.length-1];if(t.actions&&t.actions.length>0)for(let e of t.actions)this.chatActionService.executeChatAction(e);this.onNewMessage(t)}})):console.error("no flow name specified")})}ionViewDidLeave(){this.messageSubscription.unsubscribe()}onNewMessage(e){return Object(a.a)(this,void 0,void 0,function*(){if(console.log("new Message",e),e.dateReceived=new Date,this.lastReceivedMsg=e,e.character&&e.character.toLowerCase().indexOf("guide")>-1){let t=yield this.contactFieldService.getContactField("guidenumber");t&&(e.character=t)}e.isStory?this.chatViewType="story":(this.chatViewType="normal",this.allMessages.push(e),this.messages=this.showingAllMessages?this.allMessages:this.allMessages.slice(this.allMessages.length-2)),"bot"===e.sender?(this.responseOptions=e.responseOptions?e.responseOptions:[],e.showTextInput&&this.showCustomInputAlert()):this.responseOptions=[];let t=100;(e.attachments&&e.attachments.length>0||e.innerImageUrl)&&(t=1e3),setTimeout(()=>{this.chatEndDiv&&this.chatEndDiv.nativeElement.scrollIntoView({behavior:"smooth",block:"end"})},t),this.cd.detectChanges()})}doCustomResponseAction(e){"bot-leave"===e?(this.botAnimOptions={loop:!1,path:"/assets/lottie-animations/Walk_Out_Exit_Pass_v2.json"},this.botBlobState="walking-out",setTimeout(()=>this.botBlobState="absent",4200)):"bot-run-back"===e?(this.botBlobState="run-in",this.botAnimOptions={loop:!1,path:"/assets/lottie-animations/Run_In_Entrance_Pass_v2.json"},setTimeout(()=>this.botBlobState="still",3200)):"bot-walk-back"===e&&(this.botBlobState="walking-in",this.botAnimOptions={loop:!1,path:"/assets/lottie-animations/Walk_In_Entrance_Pass_v2.json"},setTimeout(()=>this.botBlobState="still",3200))}onInputSubmit(e){this.sendCustomOption(this.inputValue),this.inputValue=""}sendCustomOption(e){this.onNewMessage({text:e,sender:"user"}),this.chatService.sendMessage({text:e,sender:"user"}),this.messagesSent+=1}selectResponseOption(e){const{text:t,customAction:s}=e;s&&this.doCustomResponseAction(e.customAction);let i={text:t,sender:"user"};e.hideText&&(i.hideText=!0),e.imageUrl&&(i.innerImageUrl=e.imageUrl),this.onNewMessage(i),this.chatService.sendMessage({text:t,sender:"user"}),this.messagesSent+=1}toggleShowAllMessages(){this.showingAllMessages?(this.messages=this.allMessages.slice(this.allMessages.length-2),this.showingAllMessages=!1):(this.messages=this.allMessages,this.showingAllMessages=!0)}stringify(e){return JSON.stringify(e)}skipFlow(){this.router.navigateByUrl("/home")}sameAsLastCharacter(e,t){if(t){const e=this.allMessages.filter(e=>"bot"===e.sender).reverse().slice(0,2);if(2===e.length)return e[0].character===e[1].character}return!1}onStoryNextClicked(){this.chatService.sendMessage({sender:"user",text:"Next"})}onStoryPreviousClicked(){this.chatService.sendMessage({sender:"user",text:"Previous"})}}return e.\u0275fac=function(t){return new(t||e)(p.Mb(p.i),p.Mb(c.a),p.Mb(c.h),p.Mb(l.a),p.Mb(S.a),p.Mb(m.a),p.Mb(O),p.Mb(o.G),p.Mb(o.a),p.Mb(M.a))},e.\u0275cmp=p.Gb({type:e,selectors:[["app-chat"]],viewQuery:function(e,t){if(1&e&&p.Fc($,!0),2&e){let e;p.nc(e=p.ac())&&(t.chatEndDiv=e.first)}},inputs:{flowName:"flowName"},decls:2,vars:2,consts:[["class","container",4,"ngIf"],["class","story-chat",4,"ngIf"],[1,"container"],["class","close-button-container",4,"ngIf"],[1,"normal-chat"],["messagesContent",""],[1,"messages"],["class","auto-reply-container",4,"ngIf"],[4,"ngIf"],[3,"class",4,"ngFor","ngForOf"],["class","typing-anim",3,"options",4,"ngIf"],["normalChatEnd",""],[2,"display","block","height","50px"],[3,"responseOptions","message","onOptionSelect",4,"ngIf"],[1,"close-button-container"],["fill","clear",3,"click"],["slot","icon-only","name","close"],[1,"auto-reply-container"],[1,"msg-bubble-container",3,"ngClass"],["class","bot-msg-triangle","width","15","height","20","viewBox","0 0 15 20","fill","none","xmlns","http://www.w3.org/2000/svg",4,"ngIf"],[1,"msg-bubble"],[3,"innerHTML",4,"ngIf"],[3,"src",4,"ngIf"],["class","user-msg-triangle","width","15","height","20","viewBox","0 0 15 20","fill","none","xmlns","http://www.w3.org/2000/svg",4,"ngIf"],["class","msg-attachment",3,"ngSwitch",4,"ngFor","ngForOf"],[1,"character-image",3,"src"],["width","15","height","20","viewBox","0 0 15 20","fill","none","xmlns","http://www.w3.org/2000/svg",1,"bot-msg-triangle"],["d","M15 20V0L0 10L15 20Z","fill","grey"],[3,"innerHTML"],[3,"src"],["width","15","height","20","viewBox","0 0 15 20","fill","none","xmlns","http://www.w3.org/2000/svg",1,"user-msg-triangle"],["d","M0 20V0L15 10L0 20Z","fill","darkcyan"],[1,"msg-attachment",3,"ngSwitch"],[3,"src",4,"ngSwitchCase"],[1,"typing-anim",3,"options"],[3,"responseOptions","message","onOptionSelect"],[1,"story-chat"],[1,"story-msg-text",3,"innerHTML"],[1,"response-options"],["class","response-option",4,"ngFor","ngForOf"],[1,"response-option"],[3,"click",4,"ngIf"],[3,"click"]],template:function(e,t){1&e&&(p.yc(0,X,13,6,"div",0),p.yc(1,ie,4,2,"div",1)),2&e&&(p.ic("ngIf",!(null!=t.lastReceivedMsg&&t.lastReceivedMsg.isStory)),p.Ab(1),p.ic("ngIf",null==t.lastReceivedMsg?null:t.lastReceivedMsg.isStory))},directives:[i.l,i.k,o.d,o.l,i.j,i.n,i.o,k.a,E],styles:[".messages{padding:10px}.container,.messages{display:flex;flex-direction:column}.container{height:100%;width:100%}.close-button-container{margin-left:auto}.normal-chat{flex-grow:1;overflow-y:auto}.story-msg-text p{text-align:center}.block-image{display:block}.story-chat{flex-grow:1;overflow-y:auto;background-color:#ffff83;opacity:1;-webkit-animation-name:fadeInOpacity;animation-name:fadeInOpacity;-webkit-animation-iteration-count:1;animation-iteration-count:1;-webkit-animation-timing-function:ease-in;animation-timing-function:ease-in;-webkit-animation-duration:1s;animation-duration:1s}.story-chat h1{margin:30px}.story-chat .response-options{justify-content:center}.story-chat .block-image{border-radius:30px;max-height:300px;margin-left:auto;margin-right:auto;display:block}@-webkit-keyframes fadeInOpacity{0%{opacity:0}to{opacity:1}}@keyframes fadeInOpacity{0%{opacity:0}to{opacity:1}}.bot-blob{width:100%;height:100px;padding:5px}.bot-blob .bot-lottie{position:absolute;left:-50px;top:0;z-index:12}.bot-blob .still-bot-blob{width:30vw;position:absolute;left:49.7vw;top:3.8vw;z-index:11}@-webkit-keyframes shrink{0%{left:-75vw;width:150vw}50%{left:-75vw;width:150vw}to{left:-25vw;width:50vw}}@keyframes shrink{0%{left:-75vw;width:150vw}50%{left:-75vw;width:150vw}to{left:-25vw;width:50vw}}.msg-container{margin-bottom:20px}.msg-container .msg-bubble-container{display:flex;flex-direction:row;align-items:center}.msg-container .msg-bubble-container.user{justify-content:flex-end}.msg-container .msg-attachment>img{max-width:50vw;border:0;border-radius:20px;max-height:40vh;padding:16px}.msg-container .msg-bubble{background-color:var(--theme-var-botMsgBubble,#cae6fc);color:var(--ion-color-dark,#000);padding:16px;font-size:16px;border-radius:10px;box-shadow:4px 4px 6px grey;white-space:break-spaces}.msg-container .msg-bubble img{height:100px}.msg-container .msg-bubble .icon,.msg-container .msg-bubble .inline-image{max-height:30px}.msg-container .msg-bubble .block-image{display:block;max-height:100px}.msg-container .msg-bubble.large{font-size:40px}.msg-container.bot-msg .msg-bubble{background-color:var(--theme-var-botMsgBubble,#cae6fc)}.msg-container.user-msg .msg-bubble{background-color:var(--theme-var-userMsgBubble,#e9ebeb)}.msg-container .user-msg-triangle>path{z-index:2;fill:var(--theme-var-userMsgBubble,#e9ebeb)}.msg-container .bot-msg-triangle>path{z-index:2;fill:var(--theme-var-botMsgBubble,#cae6fc)}.msg-container.user-msg{justify-content:flex-end}.msg-container .arrow{margin:0}.response-options{max-height:50vh;align-self:flex-end;width:100%;display:flex;flex-wrap:wrap;padding:16px}.response-option{display:flex;flex-direction:column;justify-content:center;color:var(--ion-primary-color,#0d4060);background-color:#fff;padding:7px;font-size:14px;margin:10px;border-radius:20px;border:3px solid var(--ion-primary-color,#0d4060);white-space:nowrap}.response-option span{text-align:center}.response-option.large{font-size:40px;border-radius:40px}.response-option img{max-height:150px}.user-blob{position:absolute;bottom:20px;right:20px;z-index:3}.custom-input{color:#008b8b;background-color:transparent;padding:15px;font-size:20px;margin:20px;border-radius:30px;border:3px solid #008b8b;width:calc(100vw - 100px)}.show-all-button{position:absolute;left:5px;bottom:5px;z-index:20;color:#333;border:1px solid #333;border-radius:10px;display:inline;padding:8px;opacity:.8}.auto-reply-container{display:block;font-size:.6em}.skip-button{margin:16px}.typing-anim{width:60px}.character-image{max-height:120px}"],encapsulation:2}),e})(),oe=(()=>{class e{constructor(e,t){this.alertController=e,this.chatService=t}canDeactivate(e,t,s,i){return Object(a.a)(this,void 0,void 0,function*(){if(e.lastReceivedMsg&&e.lastReceivedMsg.actions&&e.lastReceivedMsg.actions.find(e=>e.type===r.a.NAVIGATE))return!0;const t=this.chatService.flowStatus$.getValue(),s=t[t.length-1];if(s&&"completed"===s.status)return!0;const i=yield this.alertController.create({header:"Are you sure you want to leave?",message:"If you leave part way through you will lose your progress",buttons:[{text:"OK",role:"ok"},{text:"Cancel",role:"cancel"}]});return i.present(),"ok"===(yield i.onDidDismiss()).role})}}return e.\u0275fac=function(t){return new(t||e)(p.Vb(o.a),p.Vb(m.a))},e.\u0275prov=p.Ib({token:e,factory:e.\u0275fac}),e})();const ce=[{path:"",redirectTo:"chat_content_flow"},{path:"action/:actionType",component:u},{path:":flowName",component:ne,canDeactivate:[oe]}];let ae=(()=>{class e{}return e.\u0275mod=p.Kb({type:e}),e.\u0275inj=p.Jb({factory:function(t){return new(t||e)},imports:[[c.j.forChild(ce)],c.j]}),e})();var re=s("PCNd");let le=(()=>{class e{}return e.\u0275mod=p.Kb({type:e}),e.\u0275inj=p.Jb({factory:function(t){return new(t||e)},providers:[oe],imports:[[i.c,n.b,o.D,re.a,ae,k.b]]}),e})()}}]);